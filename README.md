# LiMusic 用户使用说明（Wear OS）

本说明面向最终用户，帮助你在安卓手表（Wear OS）上快速上手 LiMusic：连接 Navidrome 服务器、浏览专辑/歌曲、在线播放与离线播放、管理缓存与下载。

---

## 1. 安装
- 准备好 Wear OS 设备（或模拟器），保持网络连接。
- 推荐在 Android 手机或电脑上使用 `adb` 安装：
```bash
adb install -r app/release/app-release.apk
```
- 安装后，在手表应用列表中找到「LiMusic」。

> 若使用 Android Studio 运行，请在 Studio 中选择 `app` 模块进行安装。

---

## 2. 首次设置（连接服务器）
1. 打开 LiMusic，进入主界面右上角菜单或侧边栏，点击「设置」。
2. 在设置列表点击「Navidrome 服务器设置」。
3. 依次填写：
   - 服务器地址（示例：`http://192.168.1.100` 或域名）
   - 端口（默认 `4533`）
   - 用户名、密码
4. 点击「测试连接」，成功后点击「保存」。

提示：
- 若未包含 `http://` 或 `https://`，应用会自动补全为 `http://`。
- 应用允许明文流量以兼容自建服务器，出于安全建议使用 HTTPS。

---

## 3. 浏览与播放
- 首屏默认显示专辑网格；向下滚动加载更多（分页加载，兼顾性能）。
- 点击任一专辑进入歌曲列表：
  - 点击歌曲即可播放。
  - 顶部播放栏支持「播放/暂停」与「播放模式」切换（顺序/单曲/列表循环）。
- 播放界面底部有进度条，可拖动进度（手表屏幕上为透明 SeekBar 覆盖在进度条上）。
- 专辑封面：
  - 优先使用本地已下载封面；
  - 如无本地封面，则从服务器请求并缓存。

### 3.1 快速字母索引（中文拼音）
- 在歌曲列表右上角菜单点击「字母索引」。
- 弹出字母面板（A-Z 与 #）：
  - 点击某字母即可快速定位到以该字母开头的歌曲；
  - 数字或特殊字符统一归为 `#`。

### 3.2 在线/离线播放
- 在线时：在线播放并自动写入媒体缓存。
- 断网时：
  - 应用会自动切换到离线模式；
  - 仅可播放已下载歌曲；
  - 未下载的歌曲在列表中将以弱化样式显示。

---

## 4. 下载与离线
- 在歌曲行右侧可见下载区域：
  - 显示下载按钮、进度、完成状态与失败重试提示。
  - 点击下载后会进入队列，最多并发 3 个任务。
- 下载完成后：
  - 歌曲保存到手表存储的应用私有目录：
    - `/Android/data/com.watch.limusic/files/downloads/songs`
  - 专辑封面保存到：
    - `/Android/data/com.watch.limusic/files/downloads/covers`


### 4.1 下载转码（兼容性）
- 「设置」→「下载强制转码（非MP3 → 320kbps）」：
  - 开启后，下载将强制使用 MP3 320kbps，提升兼容性（文件稍大）。
  - 关闭时默认下载 MP3（后续版本可能根据 Content-Type 自动选择更合适扩展名）。

---

## 5. 缓存与存储
- 流媒体缓存：
  - 播放时自动缓存到应用缓存目录，提升二次播放速度；
  - 可在「设置」→「清理缓存」一键清理；
  - 在「缓存详情设置」可设置最大缓存（默认 70MB，最小 20MB）。
- 下载与缓存的区别：
  - 下载是完整文件，支持离线播放；
  - 缓存为播放时产生的片段，可能不完整，不保证离线可用。

---

## 6. 设置项总览
- Navidrome 服务器设置：地址、端口、用户名、密码，测试连接与保存。
- 清理缓存：展示当前缓存占用，一键清理。
- 缓存详情设置：修改最大缓存大小（MB），重启应用后生效。
- 解码兼容模式（强制转码）：在线播放时遇到编解码问题时可尝试开启。
- 下载强制转码（非MP3 → 320kbps）：下载为 MP3 格式以提升兼容性。
- 下载管理：存储统计、下载位置、清理损坏文件、清理所有下载。

---

## 7. 权限与网络提示
- 应用需网络与音频、前台服务权限；下载功能需读写存储权限。
- 若服务器使用 HTTP（非 HTTPS），请确认已在同一局域网或信任的网络环境。
- 弱网时：
  - 播放器会增加缓冲、必要时自动回退服务器转码（MP3）以保障播放成功率；
  - UI 的进度更新做了频率控制以节省资源。

---

## 8. 常见问题（FAQ）
- 无法连接服务器：
  - 检查地址与端口是否正确，尝试在设置页「测试连接」。
  - 若使用域名，请确保解析正常；尽量使用 `http(s)://host` 格式。
- 播放无声音或中断：
  - 检查系统音量、蓝牙连接；
  - 若被其他应用抢占音频焦点，请重新点按播放。
- 下载失败或速度慢：
  - 确认网络稳定、存储空间充足；
  - 稍后重试，或开启「下载强制转码」。
- 离线时歌曲不可播放：
  - 请先在联网状态下完成下载；
  - 列表中未下载的歌曲会以弱化样式显示。

---

## 9. 小技巧
- 长时间不使用可在设置中清理缓存，节省手表存储空间与电量。

---

## 10. 关于 LiMusic
- 应用名称：LiMusic（`com.watch.limusic`）
- 版本：2.1.0
- 适配：Wear OS（手表独立应用）
- 开源依赖：ExoPlayer、Retrofit/OkHttp、Glide、AndroidX、Room、Kotlin 协程、pinyin4j 等

如需进一步帮助或反馈问题，请附带具体的错误提示或场景描述，以便更快定位与解决。

---

## 11. 歌单与多选/拖拽

### 11.1 进入歌单与新建
- 打开侧边栏/导航菜单，选择「歌单」。
- 在歌单列表页右上角点击「新建」，输入名称即可创建（默认私有，可后续切换公开/私有）。
- 在歌单列表长按某个歌单项，可选择「删除 / 设为公开(或私有) / 重命名」。
- 点击某个歌单即可进入歌单详情页。

### 11.2 歌单详情：长按多选与删除
- 在歌单详情中，长按任一歌曲进入「选择模式」，标题显示“已选择 n 首”。
- 选择模式下，右上角会显示「删除」按钮（白色图标）。点击将从本地歌单中移除选中歌曲，并尝试同步服务器。
- 若当前网络不可用，可能仅本地删除成功；稍后联网应用会自动对账并刷新显示。

### 11.3 歌单详情：拖拽排序
- 需先进入「选择模式」（长按任一歌曲）。
- 歌曲行右侧会出现「拖动柄」。按住拖动柄上下拖动即可排序，靠近列表边缘会自动滚动。
- 松手后位置会稳定停留，并在后台短暂保存到本地；当前版本不会修改服务器上的排序。
- 看不到拖动柄？请先确认已处于选择模式（长按进入）。

### 11.4 从“所有歌曲/专辑详情”添加到歌单
- 在「所有歌曲」或「专辑详情」列表中，同样可长按进入选择模式，连续点选多首。
- 点击右上角「添加到歌单」，选择目标歌单即可添加。
- 已存在于目标歌单的歌曲会自动跳过；添加顺序与选择顺序保持一致。

### 11.5 同步状态指示
- 在歌单详情标题处会显示同步状态：
  - 绿色：已同步
  - 蓝色：同步中
  - 红色：失败（可点击重试）

### 11.6 常见问题（歌单）
- 看不到拖动柄：需先长按进入选择模式。
- 删除后数量不同步：请检查网络，稍后会自动进行校验刷新。
- 拖拽不跟手或提前结束：请使用「拖动柄」进行拖拽，不要长按整行。
- 小屏优化：选择模式下下载区域会隐藏，仅显示拖动柄，避免手势冲突。

### 11.7 注意事项
- 新建/重命名/公开-私有切换会尝试同步至服务器。
- 从歌单中删除歌曲会同步服务器的歌单条目；排序目前仅在本地生效。
