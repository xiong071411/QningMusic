## 2025-10-03｜设置界面开关与长文案布局
(TechChangeSpec_2025-10-03-Settings-Switch-Layout)

### 方案总览与实现要点

将“设置”界面的布尔型选项由纯文本“已开启/关闭”改为右侧 Switch 控件，左侧保留“标题 + 摘要”纵向布局；整张卡片可点，并与开关点击互通，状态变化后仍通过摘要文本补充能力说明。对含较长描述的项，摘要限定最多 2 行并省略结尾，避免竖向空间过度膨胀，兼顾可读性与手表小屏显示效率。本次覆盖“通用设置”与“播放器设置”，不改变业务语义与存储逻辑。

### 问题回溯与根因分析

- 仅用“已开启/关闭”文本提示不直观，易被忽略。
- 含较长说明的卡片若把开关放在下方，会增加卡片高度，不利于小屏滚动效率。
- 目标：在不改变语义的前提下，提升可见性与操作直觉，并控制卡片高度。

### 受影响文件与关键点（路径相对 `app/src/main/`）

- `res/layout/activity_general_settings.xml`
  - 将 `card_transcoding`、`card_download_transcoding`、`card_low_power` 改为左右结构：左列（标题+摘要，纵向）+ 右列 `SwitchCompat@id/switch_*`。
  - 摘要 `TextView` 增加 `maxLines=2` 与 `ellipsize=end`。
- `java/com/watch/limusic/GeneralSettingsActivity.java`
  - 新增 `SwitchCompat` 字段：`swTranscoding`、`swDownloadTranscoding`、`swLowPower`；初始化与监听写入 `SharedPreferences`，调用原 `update*Summary()`；
  - 卡片点击转发为 `Switch.performClick()`；低耗模式保持原有 `Toast` 与 UI 广播。
- `res/layout/activity_player_settings.xml`
  - 为 `card_bg_blur`、`card_custom_lyrics`、`card_lyric_smooth`、`card_lyric_long_marquee`、`card_show_audio_type`、`card_auto_open_full_player`、`card_audio_visualization` 增加右侧 `SwitchCompat`，并改为左右结构；
  - 所有摘要 `TextView` 增加 `maxLines=2`、`ellipsize=end`；滑杆类卡片保持原样。
- `java/com/watch/limusic/PlayerSettingsActivity.java`
  - 新增并绑定 `SwitchCompat`：`swBgBlur`、`swCustomLyrics`、`swLyricSmooth`、`swLyricLong`、`swShowAudioType`、`swAutoOpenFullPlayer`、`swAudioVisualization`；
  - 初始化勾选态自 `SharedPreferences`；监听写入偏好并调用 `update*Summary()` 与既有 UI 广播；
  - 卡片点击统一转发为对应 `Switch.performClick()`。

### 行为变更明细

- 卡片整体可点击，等同于点击右侧开关；开关切换后立即更新摘要。
- 含长说明的摘要默认最多 2 行并末尾省略，降低竖向空间占用。
- `低耗模式` 切换维持原行为：弹出提示并发送 UI 刷新广播（含播放状态刷新）。
- 所有布尔项的开关状态与 `SharedPreferences` 保持双向同步，`update*Summary()` 仍负责文案。

### 验收用例与标准（手表优先）

1) 进入页面：各开关初始勾选态与摘要文案一致。
2) 交互一致：点击卡片与点击开关效果一致；摘要同步更新。
3) 广播保持：`低耗模式` 切换触发既有 UI 广播；播放器项（歌词/徽标/可视化/背景模糊等）广播不变。
4) 视觉稳定：不同分辨率、圆/方形手表下卡片高度与间距合理，无异常折行或溢出。

### 性能与功耗评估

- 仅替换布局结构与增加轻量 `Switch` 控件，初始化与监听为轻量主线程操作。
- 不引入新依赖，不新增复杂视图层级；功耗影响可忽略。

### 风险与回滚策略

- 视觉适配风险：个别设备上 `SwitchCompat` 比例偏大 → 可通过主题 `switchStyle` 适配。
- 摘要仍过长：可按项精简文案或进一步限制 `maxLines`。
- 回滚：移除右侧 `Switch`，恢复纵向布局；删除 Activity 中新增 Switch 字段与监听，回到卡片点击直接写偏好。

### 日志与告警优化

- 无新增日志与告警；开关切换沿用既有 UI 广播。

### 版本信息与变更摘要

- 版本：4.0Beta6（2025-10-03，合入开发分支）
- 摘要：
  - 设置布尔项统一采用右侧 Switch，提升状态可视性；
  - 含长说明的摘要限制两行省略，减小竖向空间占用；
  - 维持原广播与文案回显逻辑。



