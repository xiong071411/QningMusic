## 2025-10-02｜多选模式按钮与图标统一、菜单顺序调整
(TechChangeSpec_2025-10-02-MultiSelect-Icon-MenuOrder)

### 方案总览与实现要点
- 在 `MainActivity` 的以下视图新增/暴露“进入多选”按钮（Toolbar 入口，除长按外的第二入口）：
  - 所有歌曲
  - 专辑详情（仅歌曲列表页）
  - 歌单详情
  - 下载管理（仅“已下载”分区）
- 新增并统一“多选”图标为“双对勾”样式：`res/drawable/ic_multi_select.xml`；替代旧的条形方框勾样式，确保手表端直观性与可读性。
- 调整“所有歌曲”Toolbar 按钮顺序：`选择` 在左、`字母索引` 在右（菜单项顺序交换）。
- 修正详情页（专辑/歌单/艺术家）使用的自定义 Toolbar 标题宽度为 `WRAP_CONTENT`，避免占满导致右侧菜单不显示。

### 问题回溯与根因分析
- 多选入口不可见：详情页使用自定义标题视图宽度为 `MATCH_PARENT`，覆盖/挤压了右侧菜单区域，导致“选择”按钮不可见。
- 图标观感不佳：旧方框勾样式在表端不够直观；首版双勾存在两勾连接、大小不一致等问题。
- 操作可发现性：仅靠长按进入多选不直观，显式的 Toolbar 按钮能提升使用发现率。

### 受影响文件与关键点
- `app/src/main/res/menu/menu_songs.xml`
  - 新增 `@+id/action_enter_selection`，图标 `@drawable/ic_multi_select`，标题“选择”。
  - 调整顺序：将 `action_enter_selection` 放在 `action_letter_index` 之前，实现“选择在左、字母索引在右”。
- `app/src/main/res/menu/menu_downloads.xml`
  - 将“进入多选”图标替换为 `@drawable/ic_multi_select`。
- `app/src/main/java/com/watch/limusic/MainActivity.java`
  - `onCreateOptionsMenu(Menu)`: 按 `currentView` 控制“选择”按钮可见性；`songs/album_songs/playlist_detail` 非选择模式下可见；`downloads` 非选择模式使用 `menu_downloads`，选择模式切 `menu_downloads_selection`。
  - 修正自定义标题视图宽度：`ActionBar.LayoutParams` 宽度改为 `WRAP_CONTENT`，并去除多余 padding（避免覆盖菜单）。
  - `onOptionsItemSelected(MenuItem)`: 处理 `action_enter_selection`，进入选择模式并绑定 `OnSelectionChangedListener`，标题显示“已选择 n 首”，刷新菜单，禁用下拉刷新。
- `app/src/main/res/drawable/ic_multi_select.xml`
  - 双对勾图标实现：统一两枚对勾的几何形状，分别定位于上/下两处，确保不相连；并按反馈微调（上移/右移/下移/左移/缩放）。

### 本次补充（2025-10-02 晚）

### 方案总览与实现要点
 - 将“行内勾选”图标（仅用于多选模式的每行歌曲左侧）替换为 Task Alt 风格，契合绿色主题：
   - 已选：`res/drawable/ic_task_alt_checked.xml`（圆形填充 `@color/colorPrimary` + 白色长尾对勾）
   - 未选：`res/drawable/ic_task_alt_unchecked.xml`（圆形白色描边，无填充）
 - 仅替换歌曲列表相关适配器的行内勾选引用，不影响 Toolbar 的“双对勾”入口，也不改其他页面逻辑。

### 受影响文件与关键点
 - `app/src/main/java/com/watch/limusic/adapter/SongAdapter.java`
   - 选择模式绑定处：`checked ? R.drawable.ic_task_alt_checked : R.drawable.ic_task_alt_unchecked`
 - `app/src/main/java/com/watch/limusic/adapter/AllSongsRangeAdapter.java`
   - 选择模式绑定处：`checked ? R.drawable.ic_task_alt_checked : R.drawable.ic_task_alt_unchecked`
 - `app/src/main/res/drawable/ic_task_alt_checked.xml`
  - 向量图标：圆形填充（主题绿）+ 白色长尾对勾（线宽 3.0、圆角端/连接）
 - `app/src/main/res/drawable/ic_task_alt_unchecked.xml`
  - 向量图标：圆形白色描边（线宽 2.5）

### 微调记录（更小圆、更粗勾）
- 圆直径从 20 → 18（半径 10 → 9）：`pathData` 由 `M12,2 a10,10 ...` 调整为 `M12,3 a9,9 ...`
- 已选勾线宽从 2.6 → 3.0：提升小屏可读性，减少模糊

### 性能与功耗
 - 纯 VectorDrawable，无动画；渲染成本极低，手表端可忽略。

### 回滚与兼容
 - 如需回退，仅需将上述两处适配器的引用改回 `ic_check_box/ic_check_box_outline`。
 - 旧 `ic_check_box*` 资源仍保留以兼容其他可能的引用位置（未改动其他页面）。

### 版本信息与变更摘要
- 版本：v4.0Beta4（2025-10-02，多选按钮与图标统一、菜单顺序调整）
- 摘要：新增/暴露“进入多选”按钮；替换为双对勾图标；在“所有歌曲”中调整按钮顺序；修正详情页标题宽度避免遮挡菜单。

### 验收用例与验收标准（手表优先）
1) 所有歌曲：
- Toolbar 左侧显示“选择”，右侧显示“字母索引”。
- 点击“选择”进入多选；标题显示“已选择 n 首”，下拉刷新禁用；再次点返回退出选择模式。

2) 专辑详情 / 歌单详情：
- 非选择模式可见“选择”按钮；进入多选后“添加到歌单/删除/下载所选”按现有逻辑显示。
- 自定义标题不遮挡菜单；右侧菜单始终可见。

3) 下载管理：
- 非选择模式显示“选择”；进入后切换到 `menu_downloads_selection` 显示“删除所选”。

4) 图标一致性：
- 双对勾图标在深色 Toolbar 上清晰可读，尺寸 24dp；两个对勾清晰分离，风格一致。

### 风险与回滚
- 风险：
  - 详情页标题宽度调整可能影响长标题的跑马灯表现——已设置 `WRAP_CONTENT` + 启用跑马灯，风险可控。
  - 菜单顺序调整可能与部分设备的溢出菜单布局产生交互差异——已通过 `showAsAction="always"` 确保主要操作固定显示。
- 回滚：
  - 恢复自定义标题宽度为 `MATCH_PARENT`（不建议）。
  - 恢复旧图标或菜单顺序；移除 `action_enter_selection`。

### 性能与功耗评估
- 仅资源与菜单层面的轻量修改；对渲染与功耗影响可忽略不计。
- 双对勾为纯矢量，路径简单，无渐变/阴影。

### 问题与解决方案（过程记录）
- 问题：在专辑/歌单详情页看不到“选择”按钮。
  - 解决：自定义标题视图宽度改为 `WRAP_CONTENT` 并去除冗余 padding，菜单恢复可见。
- 问题：双对勾相连、大小不一致、位置不协调。
  - 解决：多轮微调路径坐标（右移/上移/下移/缩放/左移），最终两勾分离且风格一致。
- 问题：用户希望“所有歌曲”里按钮顺序更贴合使用习惯。
  - 解决：交换菜单项顺序，“选择”在左，“字母索引”在右。

### 回归测试要点
- 在四个页面验证“选择”按钮显示与进入多选流程。
- 标题模式/返回键行为一致；选择模式下禁用下拉刷新，退出后恢复。
- “所有歌曲”按钮顺序正确，且在窄屏手表设备不被遮挡。
- 双对勾图标在不同 DPI 下清晰，无连接、无锯齿感。
